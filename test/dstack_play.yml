# DIANA Test Bench Setup
# Merck, Spring 2018
#
# $ pushd test/vagrant && vagrant destroy && vagrant up && popd
# $ cd stack
# $ ansible-playbook -i ../_secrets/dev_inventory.yml ../test/test_stack.yml

---

# ------------------
# First for hec endpoint and logging

- name: Setup Index Endpoint (splunk)
  hosts: indexer
  roles:
  - role: splunk-dkr


# -------------------

- name: Setup DICOM Endpoint (orthanc)
  hosts: dicom
  roles:
  - role: orthanc-dkr


# -------------------

- name: Setup Task Broker (redis)
  hosts: broker
  roles:
  - role: redis-dkr


# -------------------
# Can link celery broker, index, and endpoints now

- name: Setup Diana Workers (py36)
  hosts: diana
  tags: worker
  vars:
    orthanc_pw: passw0rd!
    redis_pw: passw0rd!
    splunk_pw: passw0rd!
    diana_tok: 1234567
  roles:
  - role: diana-dkr
